openapi: 3.1.0
info:
  title: OpenMusic API
  description: A file system-based music streaming API
  version: 1.0.0
  license:
    name: MIT

servers:
  - url: http://localhost:8080/api
    description: Development server
  - url: https://api.example.com/api
    description: Production server

paths:
  /:
    get:
      summary: Info
      description: Returns information about the API including branding and details
      operationId: getInfo
      tags:
        - Info
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                required:
                  - branding
                  - details
                properties:
                  branding:
                    type: object
                    description: Branding configuration
                    properties:
                      name:
                        type: string
                      email:
                        type: string
                      short:
                        type: string
                      logo:
                        type: string
                        format: uri
                      theme:
                        type: string
                      links:
                        type: object
                  details:
                    type: object
                    description: API details
                    properties:
                      version:
                        type: string
                      capabilities:
                        type: object
              examples:
                success:
                  value:
                    branding:
                      name: "My Music Service"
                      email: "contact@example.com"
                      short: "MMS"
                      logo: "https://example.com/logo.png"
                      theme: "#0066cc"
                      links:
                        homepage: "https://example.com"
                        privacyStatement: "https://example.com/privacy"
                        donate: null
                    details:
                      version: "1.0.0"
                      capabilities:
                        search: true
                        songs: true
                        streaming: true
                        filters: false
                        artists: true
                        albums: false
                        playlists: false
                        lyrics: false
                        popular: false
                        similar: false
                        open_music_metadata: false
                        radio: false
                        random: false
                        list: false
                        upload: false
                        favorite: false
                        rate: false
                        edit: false

  /song/{id}:
    get:
      summary: Song
      description: Retrieve detailed information about a song
      operationId: getSong
      tags:
        - Songs
      parameters:
        - name: id
          in: path
          required: true
          description: The unique identifier of the song
          schema:
            type: string
      responses:
        "200":
          description: Song found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Song"
              examples:
                success:
                  value:
                    id: "abc123def456"
                    title: "Example Song Title"
                    artistName: "Example Artist"
                    releaseYear: 2024
                    coverURL: "/song/abc123def456/art"
        "404":
          description: Song not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /song/{id}/stream:
    get:
      summary: Stream
      description: Stream the audio file of a song
      operationId: streamSong
      tags:
        - Songs
      parameters:
        - name: id
          in: path
          required: true
          description: The unique identifier of the song
          schema:
            type: string
      responses:
        "200":
          description: Audio stream
          content:
            audio/mpeg:
              schema:
                type: string
                format: binary
            audio/flac:
              schema:
                type: string
                format: binary
            audio/ogg:
              schema:
                type: string
                format: binary
          headers:
            Content-Type:
              schema:
                type: string
                example: "audio/mpeg"
            Content-Length:
              schema:
                type: integer
                example: 6272474
            Accept-Ranges:
              schema:
                type: string
                example: "bytes"
        "404":
          description: Song file not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /song/{id}/art:
    get:
      summary: Cover
      description: Retrieve the cover art image for a song
      operationId: getSongArt
      tags:
        - Songs
      parameters:
        - name: id
          in: path
          required: true
          description: The unique identifier of the song
          schema:
            type: string
      responses:
        "200":
          description: Cover art found
          content:
            image/jpeg:
              schema:
                type: string
                format: binary
            image/png:
              schema:
                type: string
                format: binary
            image/webp:
              schema:
                type: string
                format: binary
        "404":
          description: Cover art not found
          content:
            text/plain:
              schema:
                type: string
              examples:
                not_found:
                  value: "404 page not found"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /songs:
    get:
      summary: Songs
      description: Retrieve a list of all available songs
      operationId: listSongs
      tags:
        - Songs
      responses:
        "200":
          description: List of songs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Song"
              examples:
                success:
                  value:
                    - id: "abc123def456"
                      title: "Example Song Title"
                      artistName: "Example Artist"
                      releaseYear: 2024
                      coverURL: "/song/abc123def456/art"
                    - id: "xyz789ghi012"
                      title: "Another Song Example"
                      artistName: "Another Artist"
                      releaseYear: 2023
                      coverURL: "/song/xyz789ghi012/art"

  /songs/search:
    get:
      summary: Search
      description: Search for songs by title, artist, or other metadata
      operationId: searchSongs
      tags:
        - Songs
      parameters:
        - name: query
          in: query
          required: true
          description: Search query string
          schema:
            type: string
      responses:
        "200":
          description: Search results
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Song"
              examples:
                found:
                  value:
                    - id: "abc123def456"
                      title: "Example Song Title"
                      artistName: "Example Artist"
                      releaseYear: 2024
                      coverURL: "/song/abc123def456/art"
                empty:
                  value: []
        "400":
          description: Missing or invalid query parameter
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /songs/random:
    get:
      summary: Random
      description: Retrieve a random song from the library
      operationId: getRandomSong
      tags:
        - Songs
      responses:
        "200":
          description: Random song
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Song"
              examples:
                success:
                  value:
                    id: "abc123def456"
                    title: "Example Song Title"
                    artistName: "Example Artist"
                    releaseYear: 2024
                    coverURL: "/song/abc123def456/art"
        "404":
          description: No songs found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

components:
  schemas:
    Song:
      type: object
      required:
        - id
        - title
      properties:
        id:
          type: string
          description: Unique identifier for the song
        title:
          type: string
          description: Title of the song
        artistName:
          type: string
          description: Name of the artist
          nullable: true
        albumName:
          type: string
          description: Name of the album
          nullable: true
        genre:
          type: string
          description: Genre of the song
          nullable: true
        releaseYear:
          type: integer
          description: Year the song was released
          nullable: true
        track:
          type: integer
          description: Track number on the album
          nullable: true
        trackTotal:
          type: integer
          description: Total number of tracks on the album
          nullable: true
        disc:
          type: integer
          description: Disc number (for multi-disc albums)
          nullable: true
        discTotal:
          type: integer
          description: Total number of discs (for multi-disc albums)
          nullable: true
        coverURL:
          type: string
          format: uri
          description: URL to the cover art image
          nullable: true
        lyrics:
          type: string
          description: Song lyrics
          nullable: true
      example:
        id: "abc123def456"
        title: "Example Song Title"
        artistName: "Example Artist"
        releaseYear: 2024
        coverURL: "/song/abc123def456/art"

    Album:
      type: object
      required:
        - id
        - title
      properties:
        id:
          type: string
          description: Unique identifier for the album
        title:
          type: string
          description: Title of the album
        artistName:
          type: string
          description: Name of the artist
          nullable: true
        artistID:
          type: integer
          description: Artist ID
          nullable: true
        genre:
          type: string
          description: Genre of the album
          nullable: true
        releaseYear:
          type: integer
          description: Year the album was released
          nullable: true
        trackCount:
          type: integer
          description: Number of tracks on the album
          nullable: true
        coverURL:
          type: string
          format: uri
          description: URL to the cover art image
          nullable: true

    Artist:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: string
          description: Unique identifier for the artist
        name:
          type: string
          description: Name of the artist
        genre:
          type: string
          description: Primary genre of the artist
          nullable: true
        imageURL:
          type: string
          format: uri
          description: URL to the artist image
          nullable: true

    Playlist:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: string
          description: Unique identifier for the playlist
        name:
          type: string
          description: Name of the playlist
        description:
          type: string
          description: Description of the playlist
          nullable: true
        imageURL:
          type: string
          format: uri
          description: URL to the playlist cover image
          nullable: true

    Error:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: Error message
        code:
          type: string
          description: Error code
          nullable: true
